version: '3'

tasks:

  enter: >
      docker run -ti --net=host
      -v $PWD/olaris:/root/olaris
      -v $PWD/test-olaris:/root/test-olaris
      --mount source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind
      test-olaris bash

  build: docker build test-olaris -t test-olaris --load

  run: >
      docker run -ti --net=host
      -v $PWD/olaris:/root/olaris
      -v $PWD/test-olaris:/root/test-olaris
      --mount source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind
      test-olaris bats test-olaris

  all:
    - task: build
    - task: run


